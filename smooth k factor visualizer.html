<!DOCTYPE html>
<html>
	<head>
		<title>
			Smooth K factor visualizer
		</title>
		<style>
			body {
				background-color: black;
				margin: 0px;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas" width="3000" height="3000">

		</canvas>
	</body>
	<script>
		function baseconv(val,base,mult,minimize) {
			base = BigInt(base);
			var number = val;
			var list = [val];
			var mult = mult ? mult : 1n;
			while(list[list.length - 1] != 0n) {
				list.push(list[list.length - 1] / BigInt(base));
				list[list.length - 2] = list[list.length - 2] % BigInt(base);
			}
			if(minimize) {
				for(let term = 0; term < list.length; term++) {
					if(list[term] > base / 2n) {
						list[term] -= base;
						list[term + 1] += 1n;
					}
				}
				if(list[list.length - 1] != 0n) {
					list.push(0n);
				}
			}
			for(let term = 0; term < list.length; term++) {
				list[term] *= mult ** BigInt(term);
			}
			return list;
		}
		function mod_pow(b,p,m) {
		    var c = 1n;
		    var l = baseconv(p,2n).reverse();
		    for(let i = 0n; i < l.length; i++) {
		        if(l[i] == 1n) {
		            c *= b;
		        }
		        c %= m;
		        if(l[i + 1n] != undefined) {
		            c **= 2n;
		        }
		    }
		    return c;
		}
		function buildSmoothK(B1) {
			var k = 1n;
			var prime = 1n;
			k *= BigInt(2 ** Math.floor(Math.log(B1) / Math.log(2)));
			while(prime ** 2n <= B1) {
				prime += 2n;
				while(mod_pow(2n, prime - 1n, prime) != 1n) {
					prime += 2n;
				}
				k *= BigInt(Number(prime) ** Math.floor(Math.log(B1) / Math.log(Number(prime))));
			}
			while(prime < B1) {
				prime += 2n;
				while(mod_pow(2n, prime - 1n, prime) != 1n) {
					prime += 2n;
				}
				k *= prime;
			}
			return k;
		}
		var dot = 0n;
		var canvas = document.getElementById("canvas").getContext("2d");
		var pixel = canvas.createImageData(1, 1);
		var number = 0n;
		var smooth = 0n;
		var spread = 8;
		setInterval(function() {
			dot++;
			smooth = buildSmoothK(dot);
			for(let number = dot * (dot + 1n) / 2n; number > 1n && smooth > 1n; number--) {
				if(smooth % number == 0n) {
					smooth /= number;
					pixel.data.set([(255 / spread) * Number(dot) % 256, (255 / spread) * Number(number) % 256, 255, 255]);
					canvas.putImageData(pixel, Number(dot), Number(number));
				}
			}
		}, 10)
	</script>
</html>
